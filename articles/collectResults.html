<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>collectResults • openMalariaUtilities</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="collectResults">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">openMalariaUtilities</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">23.02</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/collectResults.html">collectResults</a></li>
    <li><a class="dropdown-item" href="../articles/faq.html">Frequently Asked Questions</a></li>
    <li><a class="dropdown-item" href="../articles/openmalariautilities.html">Introduction to openMalariaUtilities</a></li>
    <li><a class="dropdown-item" href="../articles/scenarios.html">Multi-Scenario Experiments</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/SwissTPH/r-openMalariaUtilities/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>collectResults</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/SwissTPH/r-openMalariaUtilities/blob/master/vignettes/collectResults.Rmd" class="external-link"><code>vignettes/collectResults.Rmd</code></a></small>
      <div class="d-none name"><code>collectResults.Rmd</code></div>
    </div>

    
    
<p><code><a href="../reference/collectResults.html">collectResults()</a></code> is a powerful function and the aim of
this vignette is to explain its options in more detail.</p>
<div class="section level2">
<h2 id="output-database">Output database<a class="anchor" aria-label="anchor" href="#output-database"></a>
</h2>
<p><code><a href="../reference/collectResults.html">collectResults()</a></code> creates the following database
tables:</p>
<ul>
<li>
<code>experiments</code>: Which experiments are stored in the
DB?</li>
<li>
<code>scenarios</code>: Which scenarios per experiment are
available?</li>
<li>
<code>placeholders</code>: What placeholders are used per
scenario?</li>
<li>
<code>scenarios_metadata</code>: What metadata is available per
scenario?</li>
<li>
<code>results</code>: OpenMalaria output (per scenario).</li>
</ul>
<p>Please note that all data are identified by experiment and possibly
by scenario.</p>
<p>The table containing the simulation output (results) can be renamed
by using the <code>resultsName</code> argument and its layout can be
adjusted as needed via <code>resultsCols</code>.
<code>resultsCols</code> needs to be a list where the <code>names</code>
entry defines the column names and the <code>types</code> entry the
SQLite column types.</p>
<p>The creation of an index can be controlled by the
<code>indexOn</code> argument, which accepts a list of vectors. Each
vector is a pair of the SQLite table and column name the index should be
created on.</p>
</div>
<div class="section level2">
<h2 id="filefun-readfun-and-aggrfun">fileFun, readFun and aggrFun<a class="anchor" aria-label="anchor" href="#filefun-readfun-and-aggrfun"></a>
</h2>
<p><code><a href="../reference/collectResults.html">collectResults()</a></code> is performing three steps during the
result collection:</p>
<ol style="list-style-type: decimal">
<li>Determine which OpenMalaria output files should be read</li>
<li>Reading these files</li>
<li>Perform aggregation</li>
</ol>
<p>These three steps can be modified by the user and allow changing the
behavior of <code><a href="../reference/collectResults.html">collectResults()</a></code>. Users can write their own
functions with nearly no limitations and can pass them to
<code><a href="../reference/collectResults.html">collectResults()</a></code>’s dedicated arguments.</p>
<div class="section level3">
<h3 id="filefun">fileFun<a class="anchor" aria-label="anchor" href="#filefun"></a>
</h3>
<p><code>fileFun</code>’s job is to return a vector of scenario XML file
names. By default, the <code>file</code> column of the scenario data
frame is loaded from the cache. Usually this would be a function which
applies filtering to the scenarios data frame in order to determine the
files.</p>
</div>
<div class="section level3">
<h3 id="readfun">readFun<a class="anchor" aria-label="anchor" href="#readfun"></a>
</h3>
<p><code>readFun</code> will called upon each found output file and has
to return a data frame which is used by <code>aggrFun</code> or put into
the database. <code><a href="../reference/readOutputFile.html">readOutputFile()</a></code> should be sufficient for
most uses. In case you want to write your own implementation, make sure
that the first argument the function accepts is the file name and it has
R’s ellipsis <code>...</code> in the arguments. This is necessary so the
scenario ID can be passed automatically and can be used by your function
via <code>scenID</code>.</p>
</div>
<div class="section level3">
<h3 id="aggrfun">aggrFun<a class="anchor" aria-label="anchor" href="#aggrfun"></a>
</h3>
<p><code>aggrFun</code> is probably the function most users want to
ajust to their needs and where we do not provide any default. It needs
to accept the data frame generated from <code>readFun</code> as a first
argument and should provide the final data frame which will be put into
the database. This data frame must not have a column named
<code>experiment_id</code> and can contain a column named
<code>scenario_id</code>. Furthermore, the output needs to match the
layout defined in <code>resultsCols</code>.</p>
</div>
<div class="section level3">
<h3 id="function-arguments">Function arguments<a class="anchor" aria-label="anchor" href="#function-arguments"></a>
</h3>
<p>The arguments for the above three functions have to be (named) list.
If you need to pass unevaluated arguments, consider using
<code><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote()</a></code> and <code><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote()</a></code>.
<code><a href="../reference/collectResults.html">collectResults()</a></code> will try to remove all quotes before the
arguments are passed to the functions.</p>
</div>
</div>
<div class="section level2">
<h2 id="parallelization-and-strategy">Parallelization and strategy<a class="anchor" aria-label="anchor" href="#parallelization-and-strategy"></a>
</h2>
<p>Users can control the number of CPU cores used for the calculations
by the parameters <code>ncores</code> and <code>ncoresDT</code>. Similar
to the scenario generation and simulation step, <code>ncores</code>
determines how many R cluster nodes will be launched to perform the
calculations. <code>ncoresDT</code> sets the number of threads available
for <code>data.table</code>, which is used by us extensively. By default
this is set to one in order to avoid nested parallelization.</p>
<p>The <code>strategy</code> argument accepts <code>"serial"</code> and
<code>"batch"</code> as input values and defines how
<code><a href="../reference/collectResults.html">collectResults()</a></code> is processing the files.</p>
<p><code>"batch"</code> means that we will launch an R cluster to read
all files in parallel into one single data table. Then we will apply
aggregation function and add the whole output batch to the database.
This process is the fastest by our experience when using SQLite but can
require a lot of memory, depending on how many scenarios are
aggregated.</p>
<p><code>"serial"</code> means that we will launch an R cluster and each
node will read a file, apply the aggregation function and send the
result to the database. With SQLite, this process has been slower than
the <code>"batch"</code> stragety but also less memory intensive. We
expect it to be quite performant when a database system like PostgresSQL
is used which allows multiple simultaneous write connections.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Roland Goers, Christian Selinger, Emilie Pothin, Munir Winkel.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
